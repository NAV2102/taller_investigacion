#!/usr/bin/env python 

import numpy as np
from matplotlib import pyplot as plt
import warnings
from scipy.signal import find_peaks
import time
warnings.filterwarnings("ignore",".*GUI is implemented.*")

import rospy
from proyecto.msg import PersonConfig


class PosPerson(object):
    def __init__(self):
        topic    = 'person_config'
        self.pub = rospy.Subscriber(topic, PersonConfig, self.callback)
        self.pperson = PersonConfig()
        
        # Esperar 1 segundo
        rospy.sleep(1)
        
    def callback(self, msg):
        self.pperson = msg
        
    def get_pos_person(self):
        # Obtener la posicion de la capsula de la persona en el
        # espacio cartesiano
        ang = self.pperson.ang
        ang = np.array(ang)
        med = self.pperson.med
        med = np.array(med)
        med_f = self.pperson.med_f
        med_f = np.array(med_f)
        pos = self.pperson.pos_person
        pos = np.array(pos)     
        return ang, med, med_f, pos

        

med= [3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0]
med_f= [3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0]
ang= [0.0, 0.017120395932369446, 0.03424079186473889, 0.05136118779710834, 0.06848158372947778, 0.08560197966184722, 0.10272237559421668, 0.11984277152658612, 0.13696316745895556, 0.154083563391325, 0.17120395932369445, 0.1883243552560639, 0.20544475118843336, 0.2225651471208028, 0.23968554305317225, 0.25680593898554166, 0.27392633491791113, 0.2910467308502806, 0.30816712678265, 0.3252875227150195, 0.3424079186473889, 0.35952831457975837, 0.3766487105121278, 0.39376910644449725, 0.4108895023768667, 0.42800989830923614, 0.4451302942416056, 0.462250690173975, 0.4793710861063445, 0.4964914820387139, 0.5136118779710833, 0.5307322739034528, 0.5478526698358223, 0.5649730657681917, 0.5820934617005612, 0.5992138576329306, 0.6163342535653, 0.6334546494976695, 0.650575045430039, 0.6676954413624083, 0.6848158372947778, 0.7019362332271473, 0.7190566291595167, 0.7361770250918862, 0.7532974210242556, 0.770417816956625, 0.7875382128889945, 0.804658608821364, 0.8217790047537334, 0.8388994006861028, 0.8560197966184723, 0.8731401925508417, 0.8902605884832112, 0.9073809844155806, 0.92450138034795, 0.9416217762803195, 0.958742172212689, 0.9758625681450585, 0.9929829640774278, 1.0101033600097973, 1.0272237559421666, 1.0443441518745362, 1.0614645478069056, 1.0785849437392752, 1.0957053396716445, 1.1128257356040139, 1.1299461315363835, 1.1470665274687528, 1.1641869234011224, 1.1813073193334918, 1.1984277152658611, 1.2155481111982307, 1.2326685071306, 1.2497889030629696, 1.266909298995339, 1.2840296949277084, 1.301150090860078, 1.3182704867924473, 1.3353908827248167, 1.3525112786571862, 1.3696316745895556, 1.3867520705219252, 1.4038724664542945, 1.420992862386664, 1.4381132583190335, 1.4552336542514028, 1.4723540501837724, 1.4894744461161418, 1.5065948420485111, 1.5237152379808807, 1.54083563391325, 1.5579560298456196, 1.575076425777989, 1.5921968217103584, 1.609317217642728, 1.6264376135750973, 1.6435580095074669, 1.6606784054398362, 1.6777988013722056, 1.6949191973045752, 1.7120395932369445, 1.729159989169314, 1.7462803851016835, 1.7634007810340528, 1.7805211769664224, 1.7976415728987918, 1.8147619688311611, 1.8318823647635307, 1.8490027606959, 1.8661231566282697, 1.883243552560639, 1.9003639484930084, 1.917484344425378, 1.9346047403577473, 1.951725136290117, 1.9688455322224863, 1.9859659281548556, 2.003086324087225, 2.0202067200195946, 2.037327115951964, 2.0544475118843333, 2.071567907816703, 2.0886883037490724, 2.105808699681442, 2.122929095613811, 2.1400494915461805, 2.1571698874785503, 2.1742902834109197, 2.191410679343289, 2.2085310752756584, 2.2256514712080278, 2.2427718671403976, 2.259892263072767, 2.2770126590051363, 2.2941330549375056, 2.311253450869875, 2.328373846802245, 2.345494242734614, 2.3626146386669835, 2.379735034599353, 2.3968554305317222, 2.413975826464092, 2.4310962223964614, 2.4482166183288308, 2.4653370142612, 2.4824574101935695, 2.4995778061259393, 2.5166982020583086, 2.533818597990678, 2.5509389939230473, 2.5680593898554167, 2.585179785787786, 2.602300181720156, 2.6194205776525252, 2.6365409735848946, 2.653661369517264, 2.6707817654496333, 2.687902161382003, 2.7050225573143725, 2.722142953246742, 2.739263349179111, 2.7563837451114805, 2.7735041410438503, 2.7906245369762197, 2.807744932908589, 2.8248653288409584, 2.841985724773328, 2.8591061207056976, 2.876226516638067, 2.8933469125704363, 2.9104673085028057, 2.927587704435175, 2.944708100367545, 2.961828496299914, 2.9789488922322835, 2.996069288164653, 3.0131896840970223, 3.030310080029392, 3.0474304759617614, 3.064550871894131, 3.0816712678265, 3.0987916637588695, 3.1159120596912393, 3.1330324556236087, 3.150152851555978, 3.1672732474883474, 3.1843936434207167, 3.2015140393530865, 3.218634435285456, 3.2357548312178253, 3.2528752271501946, 3.269995623082564, 3.2871160190149338, 3.304236414947303, 3.3213568108796725, 3.338477206812042, 3.355597602744411, 3.3727179986767806, 3.3898383946091504, 3.4069587905415197, 3.424079186473889, 3.4411995824062585, 3.458319978338628, 3.4754403742709976, 3.492560770203367, 3.5096811661357363, 3.5268015620681057, 3.543921958000475, 3.561042353932845, 3.578162749865214, 3.5952831457975836, 3.612403541729953, 3.6295239376623223, 3.646644333594692, 3.6637647295270614, 3.680885125459431, 3.6980055213918, 3.7151259173241695, 3.7322463132565393, 3.7493667091889087, 3.766487105121278, 3.7836075010536474, 3.8007278969860168, 3.8178482929183866, 3.834968688850756, 3.8520890847831253, 3.8692094807154946, 3.886329876647864, 3.903450272580234, 3.920570668512603, 3.9376910644449725, 3.954811460377342, 3.9719318563097112, 3.989052252242081, 4.00617264817445, 4.023293044106819, 4.040413440039189, 4.057533835971559, 4.074654231903928, 4.091774627836298, 4.1088950237686666, 4.126015419701036, 4.143135815633406, 4.160256211565775, 4.177376607498145, 4.194497003430514, 4.211617399362884, 4.228737795295253, 4.245858191227622, 4.262978587159992, 4.280098983092361, 4.297219379024731, 4.314339774957101, 4.3314601708894696, 4.348580566821839, 4.365700962754208, 4.382821358686578, 4.399941754618948, 4.417062150551317, 4.434182546483687, 4.4513029424160555, 4.468423338348425, 4.485543734280795, 4.502664130213164, 4.519784526145534, 4.536904922077903, 4.5540253180102725, 4.571145713942642, 4.588266109875011, 4.605386505807381, 4.62250690173975, 4.63962729767212, 4.65674769360449, 4.6738680895368585, 4.690988485469228, 4.708108881401597, 4.725229277333967, 4.742349673266337, 4.759470069198706, 4.7765904651310755, 4.7937108610634445, 4.810831256995814, 4.827951652928184, 4.845072048860553, 4.862192444792923, 4.879312840725292, 4.8964332366576615, 4.913553632590031, 4.9306740285224, 4.94779442445477, 4.964914820387139, 4.982035216319509, 4.9991556122518785, 5.0162760081842475, 5.033396404116617, 5.050516800048986, 5.067637195981356, 5.084757591913726, 5.101877987846095, 5.1189983837784645, 5.136118779710833, 5.153239175643203, 5.170359571575572, 5.187479967507942, 5.204600363440312, 5.221720759372681, 5.2388411553050505, 5.255961551237419, 5.273081947169789, 5.290202343102159, 5.307322739034528, 5.324443134966898, 5.341563530899267, 5.358683926831636, 5.375804322764006, 5.392924718696375, 5.410045114628745, 5.427165510561114, 5.444285906493484, 5.4614063024258535, 5.478526698358222, 5.495647094290592, 5.512767490222961, 5.529887886155331, 5.547008282087701, 5.56412867802007, 5.581249073952439, 5.598369469884808, 5.615489865817178, 5.632610261749548, 5.649730657681917, 5.666851053614287, 5.683971449546656, 5.701091845479025, 5.718212241411395, 5.735332637343764, 5.752453033276134, 5.769573429208503, 5.786693825140873, 5.803814221073242, 5.820934617005611, 5.838055012937981, 5.85517540887035, 5.87229580480272, 5.88941620073509, 5.906536596667459, 5.923656992599828, 5.940777388532197, 5.957897784464567, 5.975018180396937, 5.992138576329306, 6.009258972261676, 6.0263793681940445, 6.043499764126414, 6.060620160058784, 6.077740555991153, 6.094860951923523, 6.111981347855892, 6.129101743788262, 6.146222139720631, 6.163342535653, 6.18046293158537, 6.197583327517739, 6.214703723450109, 6.231824119382479, 6.2489445153148475, 6.266064911247217, 6.283185307179586]

x = med*np.cos(ang)
y = med*np.sin(ang) -0.15

plt.subplot(121)
plt.plot(ang,med, 'b',ang,med_f,'r--')
plt.xlabel('Angulo(rad)')
plt.ylabel('Distancia medida')
plt.axis([0, 2*np.pi, 0, 3.5])
plt.grid()
plt.subplot(122)
plt.plot(x,y,'.b')
plt.xlabel('Posicion X')
plt.ylabel('Posicion Y')
plt.axis([-4, 4, -4, 4])
plt.grid()

plt.show()

